{"version":3,"sources":["/source/gchart_renderers.coffee","gchart_renderers.min.js"],"names":["callWithJQuery","pivotModule","exports","module","require","define","amd","jQuery","$","makeGoogleChart","chartType","extraOptions","pivotData","opts","agg","colKey","colKeys","dataArray","dataTable","defaults","groupByTitle","h","hAxisTitle","headers","i","j","k","len","len1","numCharsInHAxis","options","result","row","rowKey","rowKeys","title","v","vAxisTitle","wrapper","localeStrings","vs","by","extend","getRowKeys","length","push","getColKeys","results","join","unshift","getAggregator","value","aggregatorName","valAttrs","colAttrs","rowAttrs","width","window","height","hAxis","slantedText","vAxis","legend","position","google","visualization","arrayToDataTable","css","ChartWrapper","draw","bind","editor","ChartEditor","events","addListener","getChartWrapper","openDialog","pivotUtilities","gchart_renderers","Line Chart","Bar Chart","Stacked Bar Chart","isStacked","Area Chart","call","this"],"mappings":"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","file":"gchart_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery\n        \ncallWithJQuery ($) ->\n\n    makeGoogleChart = (chartType, extraOptions) -> (pivotData, opts) ->\n        defaults =\n            localeStrings:\n                vs: \"vs\"\n                by: \"by\"\n\n        opts = $.extend defaults, opts\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n\n        headers = (h.join(\"-\") for h in rowKeys)\n        headers.unshift \"\"\n\n        numCharsInHAxis = 0\n        dataArray = [headers]\n        for colKey in colKeys\n            row = [colKey.join(\"-\")]\n            numCharsInHAxis += row[0].length\n            for rowKey in rowKeys\n                agg = pivotData.getAggregator(rowKey, colKey)\n                if agg.value()?\n                    row.push agg.value()\n                else row.push null\n            dataArray.push row\n\n        title = vAxisTitle = pivotData.aggregatorName+ \n            if pivotData.valAttrs.length then \"(#{pivotData.valAttrs.join(\", \")})\" else \"\"\n        hAxisTitle = pivotData.colAttrs.join(\"-\")\n        title += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n        groupByTitle = pivotData.rowAttrs.join(\"-\")\n        title += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n        options = \n            width: $(window).width() / 1.4\n            height: $(window).height() / 1.4\n            title: title\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50}\n            vAxis: {title: vAxisTitle}\n\n        if dataArray[0].length == 2 and dataArray[0][1] ==  \"\"\n            options.legend = position: \"none\"\n\n        options[k] = v for k, v of extraOptions\n\n        dataTable = google.visualization.arrayToDataTable(dataArray)\n\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\n        wrapper = new google.visualization.ChartWrapper {dataTable, chartType, options}\n        wrapper.draw(result[0])    \n        result.bind \"dblclick\", -> \n            editor = new google.visualization.ChartEditor()\n            google.visualization.events.addListener editor, 'ok', -> \n                editor.getChartWrapper().draw(result[0])\n            editor.openDialog(wrapper)\n        return result\n\n    $.pivotUtilities.gchart_renderers = \n        \"Line Chart\": makeGoogleChart(\"LineChart\")\n        \"Bar Chart\": makeGoogleChart(\"ColumnChart\")\n        \"Stacked Bar Chart\": makeGoogleChart(\"ColumnChart\", isStacked: true)\n        \"Area Chart\": makeGoogleChart(\"AreaChart\", isStacked: true)\n","(function(){var t;(t=function(t){return\"object\"==typeof exports&&\"object\"==typeof module?t(require(\"jquery\")):\"function\"==typeof define&&define.amd?define([\"jquery\"],t):t(jQuery)})(function(t){var e;return e=function(e,n){return function(r,i){var a,o,l,h,s,u,g,d,c,f,v,p,C,w,y,j,b,A,S,k,m,x,T,z,q;for(u={localeStrings:{vs:\"vs\",by:\"by\"}},i=t.extend(u,i),b=r.getRowKeys(),0===b.length&&b.push([]),l=r.getColKeys(),0===l.length&&l.push([]),f=function(){var t,e,n;for(n=[],t=0,e=b.length;e>t;t++)d=b[t],n.push(d.join(\"-\"));return n}(),f.unshift(\"\"),p=0,h=[f],x=0,z=l.length;z>x;x++){for(o=l[x],y=[o.join(\"-\")],p+=y[0].length,T=0,q=b.length;q>T;T++)j=b[T],a=r.getAggregator(j,o),y.push(null!=a.value()?a.value():null);h.push(y)}A=k=r.aggregatorName+(r.valAttrs.length?\"(\"+r.valAttrs.join(\", \")+\")\":\"\"),c=r.colAttrs.join(\"-\"),\"\"!==c&&(A+=\" \"+i.localeStrings.vs+\" \"+c),g=r.rowAttrs.join(\"-\"),\"\"!==g&&(A+=\" \"+i.localeStrings.by+\" \"+g),C={width:t(window).width()/1.4,height:t(window).height()/1.4,title:A,hAxis:{title:c,slantedText:p>50},vAxis:{title:k}},2===h[0].length&&\"\"===h[0][1]&&(C.legend={position:\"none\"});for(v in n)S=n[v],C[v]=S;return s=google.visualization.arrayToDataTable(h),w=t(\"<div>\").css({width:\"100%\",height:\"100%\"}),m=new google.visualization.ChartWrapper({dataTable:s,chartType:e,options:C}),m.draw(w[0]),w.bind(\"dblclick\",function(){var t;return t=new google.visualization.ChartEditor,google.visualization.events.addListener(t,\"ok\",function(){return t.getChartWrapper().draw(w[0])}),t.openDialog(m)}),w}},t.pivotUtilities.gchart_renderers={\"Line Chart\":e(\"LineChart\"),\"Bar Chart\":e(\"ColumnChart\"),\"Stacked Bar Chart\":e(\"ColumnChart\",{isStacked:!0}),\"Area Chart\":e(\"AreaChart\",{isStacked:!0})}})}).call(this);\n//# sourceMappingURL=gchart_renderers.min.js.map"],"sourceRoot":"/source/"}