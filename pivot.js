(function(){var e,t,n,r,i,s,o,u,a,f;var l=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(this[t]===e)return t}return-1},c=function(e,t){return function(){return e.apply(t,arguments)}};e=jQuery;t=function(e){var t,n,r,i;e+="";n=e.split(".");r=n[0];i=n.length>1?"."+n[1]:"";t=/(\d+)(\d{3})/;while(t.test(r)){r=r.replace(t,"$1"+","+"$2")}return r+i};f=function(e,n){if(e==null){e=3}if(n==null){n=1}return function(r){if(r===0||isNaN(r)||!isFinite(r)){return""}else{return t((n*r).toFixed(e))}}};n={sum:function(e,t){if(e==null){e=3}if(t==null){t=1}return function(n){var r;r=n[0];return function(){return{sum:0,push:function(e){if(!isNaN(parseFloat(e[r]))){return this.sum+=parseFloat(e[r])}},value:function(){return this.sum},format:f(e,t)}}}},average:function(e,t){if(e==null){e=3}if(t==null){t=1}return function(n){var r;r=n[0];return function(){return{sum:0,len:0,push:function(e){if(!isNaN(parseFloat(e[r]))){this.sum+=parseFloat(e[r]);return this.len++}},value:function(){return this.sum/this.len},format:f(e,t)}}}},sumOverSum:function(e,t){if(e==null){e=3}if(t==null){t=1}return function(n){var r,i;i=n[0],r=n[1];return function(){return{sumNum:0,sumDenom:0,push:function(e){if(!isNaN(parseFloat(e[i]))){this.sumNum+=parseFloat(e[i])}if(!isNaN(parseFloat(e[r]))){return this.sumDenom+=parseFloat(e[r])}},value:function(){return this.sumNum/this.sumDenom},format:f(e,t)}}}},sumOverSumBound80:function(e,t,n){if(e==null){e=3}if(t==null){t=1}if(n==null){n=true}return function(r){var i,s;s=r[0],i=r[1];return function(){return{sumNum:0,sumDenom:0,push:function(e){if(!isNaN(parseFloat(e[s]))){this.sumNum+=parseFloat(e[s])}if(!isNaN(parseFloat(e[i]))){return this.sumDenom+=parseFloat(e[i])}},value:function(){var e;e=n?1:-1;return(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*e*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:f(e,t)}}}}};r={count:function(){return function(){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:f(0)}}},countUnique:function(e){var t;t=e[0];return function(){return{uniq:[],push:function(e){var n;if(n=e[t],l.call(this.uniq,n)<0){return this.uniq.push(e[t])}},value:function(){return this.uniq.length},format:f(0)}}},listUnique:function(e){var t;t=e[0];return function(){return{uniq:[],push:function(e){var n;if(n=e[t],l.call(this.uniq,n)<0){return this.uniq.push(e[t])}},value:function(){return this.uniq.join(", ")},format:function(e){return e}}}},intSum:n.sum(0),sum:n.sum(3),average:n.average(3),sumOverSum:n.sumOverSum(3),ub80:n.sumOverSumBound80(3,1,true),lb80:n.sumOverSumBound80(3,1,false)};u={"Row Barchart":function(e){return e.barchart()},Heatmap:function(e){return e.heatmap()},"Row Heatmap":function(e){return e.heatmap("rowheatmap")},"Col Heatmap":function(e){return e.heatmap("colheatmap")}};o={bin:function(e,t){var n;if("string"===typeof e){n=function(t){return t[e]}}else{n=e}return function(e){return""+(n(e)-n(e)%t)}}};e.pivotUtilities={aggregatorTemplates:n,aggregators:r,effects:u,derivers:o};s=function(e,t,n){var r,i,s,o;for(r in t){i=t[r];e[r]=(s=i(e))!=null?s:e[r]}for(r in e){if((o=e[r])==null){e[r]="null"}}return n(e)};a=function(t,n,r){var i,o,u,a,f;if(Array.isArray(t)){f=[];for(u=0,a=t.length;u<a;u++){i=t[u];f.push(s(i,n,r))}return f}else{o=[];e("thead > tr > th",t).each(function(t){return o.push(e(this).text())});return e("tbody > tr",t).each(function(t){i={};e("td",this).each(function(t){return i[o[t]]=e(this).text()});return s(i,n,r)})}};i=function(e){var t;if(Array.isArray(e)){return e}t=[];a(e,{},function(e){return t.push(e)});return t};e.fn.pivot=function(t,n){var i,s,o,u,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;p={filter:function(){return true},aggregator:r.count(),derivedAttributes:{},postProcessor:function(){}};n=e.extend(p,n);E=[];w=[];h=[];c=[];L={};C={rows:{},cols:{},all:n.aggregator()};a(t,n.derivedAttributes,function(e){var t,r,i,s,o;if(n.filter(e)){r=function(){var t,r,i,s;i=n.cols;s=[];for(t=0,r=i.length;t<r;t++){o=i[t];s.push(e[o])}return s}();t=r.join("-");s=function(){var t,r,i,s;i=n.rows;s=[];for(t=0,r=i.length;t<r;t++){o=i[t];s.push(e[o])}return s}();i=s.join("-");C.all.push(e);if(i!==""){if(l.call(E,i)<0){w.push(s);E.push(i)}if(!C.rows[i]){C.rows[i]=n.aggregator()}C.rows[i].push(e)}if(t!==""){if(l.call(h,t)<0){c.push(r);h.push(t)}if(!C.cols[t]){C.cols[t]=n.aggregator()}C.cols[t].push(e)}if(t!==""&&i!==""){if(!(i in L)){L[i]={}}if(!(t in L[i])){L[i][t]=n.aggregator()}return L[i][t].push(e)}}});x=function(e,t){if(e>t){return 1}if(e<t){return-1}return 0};s=function(e,t){return x(e.join(),t.join())};w=w.sort(s);c=c.sort(s);S=function(e,t,n){var r,i,s,o;if(t!==0){i=true;for(o=0;0<=n?o<=n:o>=n;0<=n?o++:o--){if(e[t-1][o]!==e[t][o]){i=false}}if(i){return-1}}r=0;while(t+r<e.length){s=false;for(o=0;0<=n?o<=n:o>=n;0<=n?o++:o--){if(e[t][o]!==e[t+r][o]){s=true}}if(s){break}r++}return r};b=e("<table class='pvtTable'>");_=n.cols;for(v in _){o=_[v];k=e("<tr>");if(parseInt(v)===0&&n.rows.length!==0){k.append(e("<th>").attr("colspan",n.rows.length).attr("rowspan",n.cols.length))}k.append(e("<th class='pvtAxisLabel'>").text(o));for(d in c){u=c[d];M=S(c,parseInt(d),parseInt(v));if(M!==-1){T=e("<th class='pvtColLabel'>").text(u[v]).attr("colspan",M);if(parseInt(v)===n.cols.length-1&&n.rows.length!==0){T.attr("rowspan",2)}k.append(T)}}if(parseInt(v)===0){k.append(e("<th class='pvtTotalLabel'>").text("Totals").attr("rowspan",n.cols.length+(n.rows.length===0?0:1)))}b.append(k)}if(n.rows.length!==0){k=e("<tr>");D=n.rows;for(d in D){g=D[d];k.append(e("<th class='pvtAxisLabel'>").text(g))}T=e("<th>");if(n.cols.length===0){T.addClass("pvtTotalLabel").text("Totals")}k.append(T);b.append(k)}m={value:function(){return null},format:function(){return""}};for(d in w){y=w[d];k=e("<tr>");for(v in y){A=y[v];M=S(w,parseInt(d),parseInt(v));if(M!==-1){T=e("<th class='pvtRowLabel'>").text(A).attr("rowspan",M);if(parseInt(v)===n.rows.length-1&&n.cols.length!==0){T.attr("colspan",2)}k.append(T)}}for(v in c){u=c[v];i=(P=L[y.join("-")][u.join("-")])!=null?P:m;O=i.value();k.append(e("<td class='pvtVal row"+d+" col"+v+"'>").text(i.format(O)).data("value",O))}N=(H=C.rows[y.join("-")])!=null?H:m;O=N.value();k.append(e("<td class='pvtTotal rowTotal'>").text(N.format(O)).data("value",O).data("for","row"+d));b.append(k)}k=e("<tr>");T=e("<th class='pvtTotalLabel'>").text("Totals");T.attr("colspan",n.rows.length+(n.cols.length===0?0:1));k.append(T);for(v in c){f=c[v];N=(B=C.cols[f.join("-")])!=null?B:m;O=N.value();k.append(e("<td class='pvtTotal colTotal'>").text(N.format(O)).data("value",O).data("for","col"+v))}O=C.all.value();k.append(e("<td class='pvtGrandTotal'>").text(C.all.format(O)).data("value",O));b.append(k);b.data("dimensions",[w.length,c.length]);this.html(b);n.postProcessor(b);return this};e.fn.pivotUI=function(t,n){var s,o,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I;p={derivedAttributes:{},aggregators:r,effects:u,hiddenAxes:[],cols:[],rows:[],vals:[]};n=e.extend(p,n);t=i(t);b=function(){var e;e=[];for(v in t[0]){e.push(v)}return e}();for(f in n.derivedAttributes){if(l.call(b,f)<0){b.push(f)}}o={};for(N=0,A=b.length;N<A;N++){x=b[N];o[x]={}}a(t,n.derivedAttributes,function(e){var t,n,r,i,s;s=[];for(t in e){n=e[t];if(n==null){n="null"}if((i=(r=o[t])[n])==null){r[n]=0}s.push(o[t][n]++)}return s});S=e("<table cellpadding='5'>");d=function(){var e,t;e=n.effects;t=[];for(x in e){T=e[x];t.push(x)}return t}();if(d.length!==0){d.unshift("None");h=e("<td colspan='2' align='center'>");h.append(e("<strong>").text("Effects:"));for(C=0,O=d.length;C<O;C++){x=d[C];g=e("<input type='radio' name='effects' id='effects_"+x.replace(/\s/g,"")+"'>").css({"margin-left":"15px","margin-right":"5px"}).val(x);if(x==="None"){g.attr("checked","checked")}h.append(g).append(e("<label for='effects_"+x.replace(/\s/g,"")+"'>").text(x))}S.append(e("<tr>").append(h))}c=e("<td colspan='2' id='unused' class='pvtAxisContainer pvtHorizList'>");for(k=0,M=b.length;k<M;k++){f=b[k];if(l.call(n.hiddenAxes,f)<0){(function(t){var n,r,i,s,u,a,f,l,h,p;u=Object.keys(o[t]).length;r=e("<nobr>").text(t);f=e("<div>").css({"z-index":100,width:"280px",height:"350px",overflow:"scroll",border:"1px solid gray",background:"white",display:"none",position:"absolute",padding:"20px"});f.append(e("<strong>").text(""+u+" values for "+t));if(u>20){f.append(e("<p>").text("(too many to list)"))}else{n=e("<p>");n.append(e("<button>").text("Select All").bind("click",function(){return f.find("input").attr("checked",true)}));n.append(e("<button>").text("Select None").bind("click",function(){return f.find("input").attr("checked",false)}));f.append(n);p=Object.keys(o[t]).sort();for(l=0,h=p.length;l<h;l++){s=p[l];a=o[t][s];i=e("<label>");i.append(e("<input type='checkbox' class='pvtFilter'>").attr("checked",true).data("filter",[t,s]));i.append(e("<span>").text(""+s+" ("+a+")"));f.append(e("<p>").append(i))}}r.bind("dblclick",function(t){f.css({left:t.pageX,top:t.pageY}).toggle();f.bind("click",function(e){return e.stopPropagation()});return e(document).one("click",function(){y();return f.toggle()})});return c.append(e("<li id='axis_"+t.replace(/\s/g,"")+"'>").append(r).append(f))})(f)}}S.append(e("<tr>").append(c));w=e("<tr>");s=e("<select id='aggregator'>").css("margin-bottom","5px").bind("change",function(){return y()});for(x in n.aggregators){s.append(e("<option>").val(x).text(x))}w.append(e("<td id='vals' class='pvtAxisContainer pvtHorizList'>").css("text-align","center").append(s).append(e("<br>")));w.append(e("<td id='cols' class='pvtAxisContainer pvtHorizList'>"));S.append(w);E=e("<tr>");E.append(e("<td valign='top' id='rows' class='pvtAxisContainer'>"));m=e("<td valign='top'>");E.append(m);S.append(E);this.html(S);j=n.cols;for(L=0,_=j.length;L<_;L++){x=j[L];e("#cols").append(e("#axis_"+x.replace(/\s/g,"")))}F=n.rows;for(H=0,D=F.length;H<D;H++){x=F[H];e("#rows").append(e("#axis_"+x.replace(/\s/g,"")))}I=n.vals;for(B=0,P=I.length;B<P;B++){x=I[B];e("#vals").append(e("#axis_"+x.replace(/\s/g,"")))}if(n.aggregatorName!=null){e("#aggregator").val(n.aggregatorName)}if(n.effectsName!=null){e("#effects_"+n.effectsName.replace(/\s/g,"")).attr("checked",true)}y=function(){var r,i,o,u;o={derivedAttributes:n.derivedAttributes};o.cols=[];o.rows=[];u=[];e("#rows li nobr").each(function(){return o.rows.push(e(this).text())});e("#cols li nobr").each(function(){return o.cols.push(e(this).text())});e("#vals li nobr").each(function(){return u.push(e(this).text())});o.aggregator=n.aggregators[s.val()](u);i=[];e("input.pvtFilter").not(":checked").each(function(){return i.push(e(this).data("filter"))});o.filter=function(e){var t,n,r,s;for(r=0,n=i.length;r<n;r++){s=i[r],v=s[0],t=s[1];if(e[v]===t){return false}}return true};if(d.length!==0){r=e("input[name=effects]:checked").val();if(r!=="None"){o.postProcessor=n.effects[r]}}return m.pivot(t,o)};y();e("input[name=effects]").bind("change",y);e(".pvtAxisContainer").sortable({connectWith:".pvtAxisContainer",items:"li"}).disableSelection().bind("sortstop",y);return this};e.fn.heatmap=function(t){var n,r,i,s,o,u,a;if(t==null){t="heatmap"}a=this.data("dimensions"),u=a[0],o=a[1];n=function(e,t,n){var r;r=function(){switch(e){case"red":return function(e){return"ff"+e+e};case"green":return function(e){return""+e+"ff"+e};case"blue":return function(e){return""+e+e+"ff"}}}();return function(e){var i,s;s=255-Math.round(255*(e-t)/(n-t));i=s.toString(16).split(".")[0];if(i.length===1){i=0+i}return r(i)}};r=c(function(t,r){var i,s,o;s=c(function(n){return this.find(t).each(function(){var t;t=e(this).data("value");if(t!=null&&isFinite(t)){return n(t,e(this))}})},this);o=[];s(function(e){return o.push(e)});i=n(r,Math.min.apply(Math,o),Math.max.apply(Math,o));return s(function(e,t){return t.css("background-color",i(e))})},this);switch(t){case"heatmap":r(".pvtVal","red");break;case"rowheatmap":for(i=0;0<=u?i<u:i>u;0<=u?i++:i--){r(".pvtVal.row"+i,"red")}break;case"colheatmap":for(s=0;0<=o?s<o:s>o;0<=o?s++:s--){r(".pvtVal.col"+s,"red")}}r(".pvtTotal.rowTotal","red");r(".pvtTotal.colTotal","red");return this};e.fn.barchart=function(){var t,n,r,i,s;s=this.data("dimensions"),i=s[0],r=s[1];t=c(function(t){var n,r,i,s;n=c(function(n){return this.find(t).each(function(){var t;t=e(this).data("value");if(t!=null&&isFinite(t)){return n(t,e(this))}})},this);s=[];n(function(e){return s.push(e)});r=Math.max.apply(Math,s);i=function(e){return 100*e/(1.4*r)};return n(function(t,n){var r,s;r=n.text();s=e("<div>").css({position:"relative",height:"55px"});s.append(e("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:i(t)+"%","background-color":"gray"}));s.append(e("<div>").text(r).css({position:"relative","padding-left":"5px","padding-right":"5px"}));return n.css({padding:0,"padding-top":"5px","text-align":"center"}).html(s)})},this);for(n=0;0<=i?n<i:n>i;0<=i?n++:n--){t(".pvtVal.row"+n)}t(".pvtTotal.colTotal");return this}}).call(this)